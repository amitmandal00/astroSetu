# Bundle Retry Fix

## ğŸ”´ Issue
Retry loading bundle option is broken - clicking retry doesn't regenerate the bundle.

## ğŸ” Root Cause
The `handleRetryLoading` function calls `generateBundleReports` without resetting the generation guards first. The `generateBundleReports` function checks at the start:

```typescript
if (isGeneratingRef.current || bundleGenerating) {
  console.warn("[Bundle Generation] Request ignored - already generating reports");
  return;
}
```

If these guards are still `true` from a previous failed attempt, the retry is blocked and the function returns early without doing anything.

## âœ… Fix
Reset all generation guards before calling `generateBundleReports` in the retry handler:

1. `isGeneratingRef.current = false`
2. `bundleGeneratingRef.current = false`
3. `hasAutoGeneratedRef.current = false`
4. `setBundleGenerating(false)`

Also reset guards in the error handler to allow another retry if this one fails.

## ğŸ“‹ Changes
- **File**: `src/app/ai-astrology/preview/page.tsx`
- **Function**: `handleRetryLoading` (around line 1987)
- **Change**: Added guard reset before calling `generateBundleReports`
- **Change**: Added guard reset in error handler

## ğŸ¯ Status
- âœ… Fix implemented
- âœ… Guards reset before retry
- âœ… Guards reset on error
- â³ Manual testing needed

